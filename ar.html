<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailAR - WebXR Product Scanner</title>
    
    <!-- A-Frame for WebXR support -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- AR.js for marker-based AR -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background: #000;
            color: white;
        }
        
        .ar-info {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
        }
        
        .ar-info h3 {
            margin: 0 0 10px 0;
            color: #667eea;
        }
        
        .ar-info p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        .ar-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            gap: 10px;
        }
        
        .ar-btn {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .ar-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        
        .hidden {
            display: none !important;
        }
        
        .ar-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            text-align: center;
        }
        
        .loading-spinner {
            border: 4px solid #333;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .marker-instructions {
            position: absolute;
            top: 60px;
            left: 10px;
            right: 10px;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="ar-loading" id="ar-loading">
        <div class="loading-spinner"></div>
        <p>Initializing AR Camera...</p>
    </div>

    <div class="marker-instructions" id="marker-instructions">
        <p><strong>Point your camera at the Hiro marker or any QR code</strong></p>
        <p>Move your device around to see 3D products in AR</p>
    </div>
    
    <div class="ar-info hidden" id="product-info">
        <h3 id="product-name">Product Name</h3>
        <p><strong>Price:</strong> <span id="product-price">$0.00</span></p>
        <p id="product-desc">Product description</p>
        <div id="product-features"></div>
    </div>
    
    <div class="ar-controls">
        <button class="ar-btn" onclick="location.href='index.html'">Back to Scanner</button>
        <button class="ar-btn" onclick="switchProduct()">Next Product</button>
        <button class="ar-btn" onclick="resetView()">Reset View</button>
    </div>
    
    <!-- A-Frame AR Scene -->
    <a-scene
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        embedded
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
        loading-screen="dotsColor: red; backgroundColor: black"
        device-orientation-permission-ui="enabled: false"
    >
        <!-- Assets -->
        <a-assets>
            <!-- Textures and materials can be preloaded here -->
            <a-mixin id="product-animation" 
                     animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear">
            </a-mixin>
        </a-assets>
        
        <!-- Marker-based AR -->
        <a-marker preset="hiro" id="hiro-marker">
            <!-- Smart Water Bottle -->
            <a-cylinder 
                id="product-bottle"
                position="0 0.5 0" 
                radius="0.3" 
                height="1.5" 
                color="#0066ff"
                opacity="0.8"
                mixin="product-animation"
                class="clickable"
            >
                <!-- Bottle cap -->
                <a-cylinder 
                    position="0 0.8 0" 
                    radius="0.25" 
                    height="0.2" 
                    color="#333333">
                </a-cylinder>
                
                <!-- LED indicators (small spheres) -->
                <a-sphere position="0 0.3 0.35" radius="0.05" color="#00ff00"></a-sphere>
                <a-sphere position="0 0.1 0.35" radius="0.05" color="#ffff00"></a-sphere>
                <a-sphere position="0 -0.1 0.35" radius="0.05" color="#ff0000"></a-sphere>
            </a-cylinder>
            
            <!-- Product label/text -->
            <a-text 
                value="Smart Water Bottle\n$29.99" 
                position="0 2.2 0" 
                align="center" 
                color="#ffffff"
                scale="1.5 1.5 1.5">
            </a-text>
        </a-marker>
        
        <!-- Alternative marker for different products -->
        <a-marker preset="kanji" id="kanji-marker">
            <!-- Wireless Earbuds -->
            <a-group id="earbuds-group">
                <!-- Left earbud -->
                <a-sphere 
                    position="-0.3 0.5 0" 
                    radius="0.15" 
                    color="#333333"
                    mixin="product-animation">
                </a-sphere>
                
                <!-- Right earbud -->
                <a-sphere 
                    position="0.3 0.5 0" 
                    radius="0.15" 
                    color="#333333"
                    mixin="product-animation">
                </a-sphere>
                
                <!-- Charging case -->
                <a-box 
                    position="0 0.1 0" 
                    width="0.8" 
                    height="0.3" 
                    depth="0.5" 
                    color="#666666"
                    radius="0.1">
                </a-box>
            </a-group>
            
            <a-text 
                value="Wireless Earbuds\n$149.99" 
                position="0 1.5 0" 
                align="center" 
                color="#ffffff"
                scale="1.2 1.2 1.2">
            </a-text>
        </a-marker>
        
        <!-- Custom QR code marker -->
        <a-marker type="pattern" url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro">
            <!-- Gaming Mouse -->
            <a-box 
                position="0 0.5 0" 
                width="0.6" 
                height="0.2" 
                depth="1" 
                color="#ff0000"
                mixin="product-animation">
                
                <!-- Mouse scroll wheel -->
                <a-cylinder 
                    position="0 0.15 0.1" 
                    radius="0.05" 
                    height="0.1" 
                    color="#333333">
                </a-cylinder>
                
                <!-- RGB lighting effect -->
                <a-light type="point" color="#ff0000" position="0 0.2 0" intensity="0.5"></a-light>
            </a-box>
            
            <a-text 
                value="Gaming Mouse\n$79.99" 
                position="0 1.2 0" 
                align="center" 
                color="#ffffff">
            </a-text>
        </a-marker>
        
        <!-- Camera entity -->
        <a-camera-static></a-camera-static>
    </a-scene>

    <script>
        let currentProductIndex = 0;
        const products = [
            {
                name: "Smart Water Bottle",
                price: "$29.99",
                description: "Tracks hydration with LED indicators and smartphone connectivity.",
                features: ["Temperature monitoring", "Hydration tracking", "Bluetooth connectivity", "LED indicators"]
            },
            {
                name: "Wireless Earbuds", 
                price: "$149.99",
                description: "Premium earbuds with noise cancellation and 8-hour battery.",
                features: ["Active noise cancellation", "8-hour battery", "Water resistant", "Touch controls"]
            },
            {
                name: "Gaming Mouse",
                price: "$79.99", 
                description: "High-precision mouse with RGB lighting and programmable buttons.",
                features: ["RGB lighting", "Programmable buttons", "16000 DPI sensor", "Ergonomic design"]
            }
        ];

        // Hide loading screen when AR is ready
        document.querySelector('a-scene').addEventListener('loaded', function() {
            document.getElementById('ar-loading').classList.add('hidden');
        });
        
        // Show product info when marker is found
        document.querySelector('#hiro-marker').addEventListener('markerFound', function() {
            showProductInfo(products[0]);
            document.getElementById('marker-instructions').classList.add('hidden');
        });
        
        document.querySelector('#kanji-marker').addEventListener('markerFound', function() {
            showProductInfo(products[1]);
            document.getElementById('marker-instructions').classList.add('hidden');
        });
        
        // Hide product info when marker is lost
        document.querySelector('#hiro-marker').addEventListener('markerLost', function() {
            document.getElementById('product-info').classList.add('hidden');
            document.getElementById('marker-instructions').classList.remove('hidden');
        });
        
        document.querySelector('#kanji-marker').addEventListener('markerLost', function() {
            document.getElementById('product-info').classList.add('hidden');
            document.getElementById('marker-instructions').classList.remove('hidden');
        });

        function showProductInfo(product) {
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-price').textContent = product.price;
            document.getElementById('product-desc').textContent = product.description;
            
            const featuresDiv = document.getElementById('product-features');
            featuresDiv.innerHTML = '<strong>Features:</strong><ul>' + 
                product.features.map(feature => `<li>${feature}</li>`).join('') + 
                '</ul>';
            
            document.getElementById('product-info').classList.remove('hidden');
        }

        function switchProduct() {
            currentProductIndex = (currentProductIndex + 1) % products.length;
            showProductInfo(products[currentProductIndex]);
        }

        function resetView() {
            // Reset camera position or reload scene
            location.reload();
        }
        
        // Handle device orientation for mobile
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(response => {
                    if (response == 'granted') {
                        console.log('Device orientation permission granted');
                    }
                })
                .catch(console.error);
        }
    </script>
</body>
</html>